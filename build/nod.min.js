/*! Nod 2014-04-01, by Gorm Casper */
!function(a,b){"use strict";function c(){var a=arguments;return function(){for(var b=arguments,c=a.length;c--;)b=[a[c].apply(this,b)];return b[0]}}function d(a){return a[0]}function e(a){var b=function(a,b){return Array.prototype.slice.call(a,b||0)},c=b(arguments,1);return function(){return a.apply(this,c.concat(b(arguments)))}}function f(a,b){var c=function(a,b){return Array.prototype.slice.call(a,b||0)};return b=b||a.length,function(){var d;return arguments.length<b?(d=b-arguments.length,b-d>0?f(e.apply(this,[a].concat(c(arguments))),d):e.apply(this,[a].concat(c(arguments)))):a.apply(this,arguments)}}function g(a){if(a&&a.constructor&&a.call&&a.apply)return a;if(a instanceof RegExp)return function(b){return a.test(b)};var b=a.split(":"),c=b.shift(),d=B[c];if(!d)throw new Error("I don't know how to check for: "+c);return d.apply(this,b)}function h(){this.$form=$(F.form),this.$submit=$(F.submitBtn),this.$els=[],this.formListener(),o(c(this.add,y("$el")).bind(this),D.items),this.toggleBtn()}function i(a){this.el=a,this.$el=$(this.el),this.group=this.$el.parents(F.groupSelector),this.textHolder=$("<span/>",{"class":F.helpTextClass+" "+F.helpTextClassId}).hide(),this.checks=[],this.validText="",this.isValid=null,this.validates=[],this.listeningTo=[],this.getValue=this.makeGetValue(),this.addTextHolderToDom()}function j(a){var b=$(n("selector",a).join());this.items=[],this.metrics=a,o(this.addElement.bind(this),b),this.attachCheckersFromExpandedMetrics()}function l(a,b){function c(a){$(a).each(function(){var b=D.add.call(D,this);b&&(o(attachListener,[b]),E.add(a))})}function d(){D.dispose(),E.dispose()}return F=z(G,b),D=new j(a),E=new h,{add:c,remove:D.remove.bind(D),checkers:B,allValid:D.allAreValid.bind(D),dispose:d}}var m=(console.log.bind(console),f(function(a,b){return b(a)})),n=(f(function(a,b){return b[a]()}),f(function(a,b){for(var c=[],d=-1;++d<b.length;)b[d]&&c.push(b[d][a]);return c})),o=f(function(a,b){if(b.forEach)return b.forEach(a);if(b.length===+b.length)for(var c=-1;++c<b.length;)a(b[c]);else for(var d in b)b.hasOwnProperty(d)&&a(b[d]);return b}),p=f(function(a,b){var c,d;if(b.map)return b.map(a);if(b.length===+b.length){for(c=[],d=-1;++d<b.length;)c.push(a(b[d]));return c}c={};for(var e in items_)b.hasOwnProperty(k)&&(c[e]=a(b[e]));return c}),q=f(function(a,b,c){for(var d=-1;++d<c.length;)b=a(b,c[d]);return b}),r=f(function(a,b){for(var c=-1;++c<b.length;)if(!a(b[c]))return!1;return!0}),s=f(function(a,b){for(var c=-1;++c<b.length;)if(a(b[c]))return!0;return!1}),t=f(function(a,b){return b===a}),u=f(function(a,b){return b!==a}),v=f(function(a,b){var c=b.length;if(c===+c){for(var d=-1;++d<c;)if(a(b[d]))return b[d]}else for(var e in b)if(b.hasOwnProperty(e)&&a(b[e]))return b[e]}),w=f(function(a,b){for(var c=0;c<b.length;c++)if(b[c]===a)return c;return-1}),x=f(function(a,b){var c,d;if(b.filter)return b.filter(a);if(b.length===+b.length){for(c=[],d=-1;++d<b.length;)a(b[d])&&c.push(b[d]);return c}c={};for(var e in b)b.hasOwnProperty(e)&&a(b[e])&&(c[e]=b[e]);return c}),y=f(function(a,b){return b[a]}),z=f(function(a,b){for(var c={},d=-1,e=[a,b];++d<2;)for(var f in e[d])e[d].hasOwnProperty(f)&&(c[f]=e[d][f]);return c}),A=function(a,b,c){var d,e,f,g,h;return function(){f=this,e=arguments,g=new Date;var i=function(){var j=new Date-g;b>j?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e)))},j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e)),h}},B={presence:function(){return function(a){return!!a}},"presence-if":function(a,b){var c=$(a);return function(a){return c.val()===b?!!a:!0}},empty:function(){return function(a){return 0===a.length||!1}},exact:function(a){return function(b){return b===a}},not:function(a){return function(b){return b!==a}},"same-as":function(a){var b=$(a);if(1!==b.length)throw new Error("same-as selector must target one and only one element");return function(a){return a===b.val()}},"one-of":function(a){var b=$(a);return function(){var a=b.map(function(){return this.value}).get().join("");return!!a}},"all-or-none":function(a){var b=$(a);return function(){var a=b.map(function(){return!!this.value}).get();return r(t(!0),a)||r(t(!1),a)}},min:function(a){return function(b){var c=isNaN(b)?b.length:+b;return c>=+a}},max:function(a){return function(b){var c=isNaN(b)?b.length:+b;return+a>=c}},between:function(a,b){return function(c){var d=isNaN(c)?c.length:+c;return d>=+a&&+b>=d}},"exact-length":function(a){return function(b){return b.length===+a}},"min-length":function(a){return function(b){return b.length>=+a}},"max-length":function(a){return function(b){return b.length<=+a}},integer:function(){return function(a){return C.int.test(a)}},"float":function(){return function(a){return C.float.test(a)}},email:function(){return function(a){return C.email.test(a)}}};B["min-num"]=B.min,B["max-num"]=B.max,B["between-length"]=B["between-num"]=B.between;var C={"int":/^\s*\d+\s*$/,"float":/^\s*[-+]?[0-9]+(\.[0-9]+)\s*?$/,email:/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/};h.prototype.add=function(a){this.$els.push(a.on("toggle:isValid",this.toggleBtn.bind(this)))},h.prototype.toggleBtn=function(){var a=!D.allAreValid();this.$submit.prop("disabled",a).toggleClass("disabled",a)},h.prototype.formListener=function(){this.$form.on("submit.nod",function(a){D.allAreValid()||(a.preventDefault(),D.firstInputWithError().trigger("change").focus())})},h.prototype.dispose=function(){this.$form.off("submit.nod"),o(function(a){a.off("toggle:isValid")},this.$els),this.$submit.prop("disabled",!1).toggleClass("disabled",!1)},i.prototype.makeGetValue=function(){return"checkbox"===this.$el.attr("type")?function(){return this.$el.is(":checked")}:function(){return $.trim(this.el.value)}},i.prototype.validate=function(){return r(t(!0),this.getResults())},i.prototype.getResults=function(){return p(m(this.getValue()),this.checks)},i.prototype.addTextHolderToDom=function(){var a=this.group.find("."+F.helpTextClassId),b=this.$el.attr("type");"radio"===b&&a.length?this.textHolder=a:"radio"===b||"checkbox"===b?this.group.append(this.textHolder):this.$el.after(this.textHolder)},i.prototype.addCheck=function(a,b){this.checks.push(function(c){return a(c)?!0:b}),this.isValid=this.validate()||null},i.prototype.setValidText=function(a){this.validText=a},i.prototype.addValidate=function(a){this.validates=this.validates.concat(a)},i.prototype.getOtherElements=q(function(a,b){if("function"==typeof b)return a;var c=F.containsSelectors,d=b.split(":");return s(t(d[0]),c)&&a.push($(d[1])),a},[]),i.prototype.attachListeners=function(){this.listenTo(this.$el),o(this.listenTo.bind(this),this.getOtherElements(this.validates))},i.prototype.listenTo=function(a){var b=this.runCheck.bind(this),c=this.listeningTo;a.each(function(){var a=$(this);a.on("keyup.nod",A(b,700)).on("change.nod blur.nod",b),c.push(a)})},i.prototype.runCheck=function(){var a=this.validate(),c=d(x(u(!0),this.getResults()))||this.validText;c!==b?this.textHolder.html(c).fadeIn():this.textHolder.hide(),this.group.toggleClass(F.groupValidClass,a).toggleClass(F.groupErrorClass,!a),this.isValid!==a&&(this.isValid=a,this.$el.trigger("toggle:isValid"))},i.prototype.dispose=function(){this.textHolder.remove(),o(function(a){a.off("keyup.nod change.nod blur.nod")},this.listeningTo),this.group.removeClass(F.groupErrorClass).removeClass(F.groupValidClass)},j.prototype.add=function(a){var b=this.addElement(a);return b?(this.attachCheckersFromExpandedMetrics([b]),b):void 0},j.prototype.addElement=function(a){var b;return r(c(u(a),y("el")),this.items)&&(b=new i(a),this.items.push(b)),b},j.prototype.remove=function(a){o(function(a){var b=v(c(t(a),y("el")),this.items);this.disposeItem.call(this,b)}.bind(this),$(a))},j.prototype.dispose=function(){o(this.disposeItem.bind(this),this.items)},j.prototype.disposeItem=function(a){a.dispose();var b=w(a,this.items);b>-1&&this.items.splice(b,1)},j.prototype.expandMetrics=p(function(a){"object"!=typeof a.validate&&(a.validate=[a.validate],a.errorText=[a.errorText]);var b=p(function(b){return s(t(b),F.needsToKnowSisters)?b+":"+a.selector:b},a.validate),c=p(function(b){return g(b,a.selector)},b);return{$els:$(a.selector),checks:c,validate:b,validText:a.validText,errorTexts:a.errorText}}),j.prototype.attachCheckersFromExpandedMetrics=function(a){var b=this.attachChecker,d=a||this.items;o(function(a){a.$els.each(function(){var e=v(c(t(this),y("el")),d);e&&(b(a,e),e.attachListeners())})},this.expandMetrics(this.metrics))},j.prototype.attachChecker=function(a,b){for(var c=0;c<a.checks.length;c++)b.addCheck(a.checks[c],a.errorTexts[c]);b.setValidText(a.validText),b.addValidate(a.validate)},j.prototype.allAreValid=function(){return r(c(t(!0),y("isValid")),this.items)},j.prototype.firstInputWithError=function(){return v(c(u(!0),y("isValid")),this.items).$el};var D,E,F,G={groupSelector:".form-group",groupValidClass:"has-success",groupErrorClass:"has-error",helpTextClass:"help-block",helpTextClassId:"nod-text",containsSelectors:["presence-if","same-as","one-of","all-or-none"],needsToKnowSisters:["one-of","all-or-none"]};l.checkers=B,a.nod=l}(window);